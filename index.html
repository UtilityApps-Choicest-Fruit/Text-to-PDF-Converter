<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Text to PDF Converter</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Text to PDF Converter</h1>
        <form id="convertForm">
            <label for="textFile">Select a text file:</label>
            <input type="file" id="textFile" accept=".txt" required>
            <button type="submit">Convert to PDF</button>
        </form>
        <div id="result"></div>

        <!-- Drop zone for text -->
        <div id="dropZone">
            <p>Drag and drop a text file here<br><span></span><br></p>
            <input type="file" id="dropFile" accept=".txt" style="display:none;">
        </div>
    </div>
    <!-- Load pdf-lib from CDN FIRST -->
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
    <script>
function runApp() {
    if (!window.pdfLib) {
        setTimeout(runApp, 100); // Try again in 100ms
        return;
    }

    document.getElementById('convertForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const fileInput = document.getElementById('textFile');
        const file = fileInput.files[0];
        if (!file) return;

        const text = await file.text();

        const { PDFDocument, StandardFonts } = window.pdfLib;
        const pdfDoc = await PDFDocument.create();
        const page = pdfDoc.addPage();
        const font = await pdfDoc.embedFont(StandardFonts.Helvetica);
        const fontSize = 12;
        const { width, height } = page.getSize();

        // Split text into lines and write to PDF
        const lines = text.split('\n');
        let y = height - 40;
        for (let line of lines) {
            if (y < 40) break;
            page.drawText(line, { x: 40, y, size: fontSize, font });
            y -= fontSize + 4;
        }

        const pdfBytes = await pdfDoc.save();
        const blob = new Blob([pdfBytes], { type: 'application/pdf' });
        const url = URL.createObjectURL(blob);

        document.getElementById('result').innerHTML = `
            <a href="${url}" download="output.pdf">Download PDF</a>
            <br><br>
            <iframe src="${url}" width="100%" height="500px" style="border:1px solid #d1d9e6; border-radius:8px;"></iframe>
        `;
    });

    // Drag and drop functionality
    const dropZone = document.getElementById('dropZone');
    const dropFile = document.getElementById('dropFile');
    const fileInput = document.getElementById('textFile');

    dropZone.addEventListener('click', () => dropFile.click());

    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('dragover');
    });

    dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('dragover');
    });

    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('dragover');
        if (e.dataTransfer.files.length) {
            dropFile.files = e.dataTransfer.files;
            fileInput.files = e.dataTransfer.files; // Sync with form input
        }
    });

    // When user selects a file using the "Choose File" input, update the hidden dropFile input
    fileInput.addEventListener('change', () => {
        dropFile.files = fileInput.files;
    });

    // When user selects a file using the drop zone, update the visible file input (already present)
    dropFile.addEventListener('change', () => {
        fileInput.files = dropFile.files;
    });
}
runApp();
</script>
</body>
</html>